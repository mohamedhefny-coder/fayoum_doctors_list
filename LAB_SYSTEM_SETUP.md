# دليل إعداد نظام المعامل الطبية مع Supabase

## الخطوات المطلوبة:

### 1. إنشاء جدول المعامل في Supabase

1. افتح لوحة تحكم Supabase
2. اذهب إلى SQL Editor
3. انسخ والصق محتوى ملف `create_labs_table.sql`
4. قم بتشغيل الأمر SQL

### 2. التأكد من إعداد Authentication

تأكد من أن Supabase Authentication مفعل في مشروعك:
- اذهب إلى Authentication > Settings
- تأكد من تفعيل Email provider
- يمكنك تعطيل "Confirm email" إذا أردت تسريع التطوير

### 3. آلية العمل

#### أ. تسجيل حساب المعمل (من صفحة المدير):
1. المدير يضغط على زر "إضافة معمل"
2. يفتح نموذج التسجيل (`lab_register_screen.dart`)
3. إدخال: اسم المعمل، البريد الإلكتروني، كلمة المرور
4. يتم إنشاء حساب في Supabase Auth مع metadata يحتوي على:
   - `user_type: 'lab'`
   - `lab_name: 'اسم المعمل'`
5. يتم إنشاء سجل في جدول `labs` مربوط بـ `user_id`

#### ب. تسجيل دخول المعمل:
1. المستخدم (صاحب المعمل) يضغط على زر "معامل" → زر "+"
2. يفتح نموذج تسجيل الدخول (`lab_login_screen.dart`)
3. إدخال البريد الإلكتروني وكلمة المرور
4. التحقق من أن `user_type = 'lab'`
5. بعد النجاح، يفتح صفحة إضافة البيانات

#### ج. إضافة بيانات المعمل:
1. صاحب المعمل يملأ جميع البيانات في (`add_lab_screen.dart`):
   - المعلومات الأساسية (اسم، عنوان، هاتف، واتساب، إيميل)
   - ساعات العمل
   - العروض
   - التعاقدات
   - المميزات
   - التحاليل المتاحة
2. عند الضغط على "حفظ"، يتم:
   - حفظ/تحديث البيانات في جدول `labs`
   - ربط البيانات بـ `user_id` الخاص بالمعمل

### 4. الملفات المهمة

#### Services:
- `lib/services/lab_service.dart` - يحتوي على جميع عمليات Supabase

#### Models:
- `lib/models/lab_model.dart` - موديل المعمل مع fromJson/toJson

#### Screens:
- `lib/screens/lab_register_screen.dart` - تسجيل حساب جديد
- `lib/screens/lab_login_screen.dart` - تسجيل الدخول
- `lib/screens/add_lab_screen.dart` - إضافة/تعديل بيانات المعمل

### 5. الصلاحيات (RLS Policies)

الجدول محمي بـ Row Level Security:

**للقراءة:**
- الجميع يمكنهم رؤية المعامل المنشورة (`is_published = true`)
- صاحب المعمل يمكنه رؤية معمله الخاص
- المدراء يمكنهم رؤية جميع المعامل

**للكتابة:**
- صاحب المعمل فقط يمكنه تعديل معمله
- المدراء يمكنهم تعديل أي معمل

### 6. ملاحظات مهمة

1. **حقل `is_published`**: افتراضياً `false` - المدير يحتاج لنشر المعمل
2. **Authentication**: يستخدم Supabase Auth للتحقق
3. **User Metadata**: يحتوي على `user_type` للتمييز بين الأطباء والمعامل
4. **Tests Field**: يُحفظ كـ JSONB لسهولة التعامل مع التصنيفات

### 7. التطوير المستقبلي

يمكن إضافة:
- لوحة تحكم خاصة بالمعامل لتعديل البيانات
- نظام موافقة المدير على نشر المعامل
- إضافة الصور للمعامل
- نظام التقييمات
- البحث والفلترة المتقدمة
