# โ ุงูุญู ุงูููุงุฆู ููุดููุฉ ุฅุถุงูุฉ ุงูุฃุทุจุงุก

## ๐ ุงููุดุงูู ุงูุชู ุชู ุญููุง:

### 1. โ ุฅุถุงูุฉ ุงูุทุจูุจ ุชูุดู
**ุงูุณุจุจ**: ุณูุงุณุงุช RLS ูุง ุชุณูุญ ููุทุจูุจ ุงูุฌุฏูุฏ ุจุฅุถุงูุฉ ุจูุงูุงุชู

### 2. โ ุงูุทุจูุจ ูุง ูุธูุฑ ูู ููุญุฉ ุงููุฏูุฑ
**ุงูุณุจุจ**: ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ ุจุนุฏ ุฅูุดุงุก ุงูุทุจูุจ

### 3. โ ุงูุทุจูุจ ูุง ูุณุชุทูุน ุชุนุฏูู ุจูุงูุงุชู
**ุงูุณุจุจ**: ุณูุงุณุงุช UPDATE ุบูุฑ ููุฌูุฏุฉ ููุฃุทุจุงุก

---

## ๐ง ุงูุฎุทูุงุช ุงููุทููุจุฉ ูุฅุตูุงุญ ุงููุดููุฉ:

### ุงูุฎุทูุฉ 1๏ธโฃ: ุชุญุฏูุซ ุณูุงุณุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุชุญ Supabase Dashboard** โ **SQL Editor** ูููุฐ ุงูุณูุฑูุจุช ุงูุชุงูู:

```sql
-- ุญุฐู ุฌููุน ุงูุณูุงุณุงุช ุงููุฏููุฉ
DROP POLICY IF EXISTS "Only admins can insert new doctors" ON public.doctors;
DROP POLICY IF EXISTS "Admins can insert any doctor" ON public.doctors;
DROP POLICY IF EXISTS "Users can insert their own doctor profile" ON public.doctors;
DROP POLICY IF EXISTS "Doctors can update their own profile" ON public.doctors;
DROP POLICY IF EXISTS "Admins can update any doctor" ON public.doctors;
DROP POLICY IF EXISTS "Doctors can delete their own profile" ON public.doctors;
DROP POLICY IF EXISTS "Admins can delete any doctor" ON public.doctors;

-- ุณูุงุณุงุช ุงูุฅุถุงูุฉ (INSERT)
CREATE POLICY "Admins can insert any doctor"
  ON public.doctors FOR INSERT
  WITH CHECK (auth.uid() IN (SELECT id FROM public.admins));

CREATE POLICY "Users can insert their own doctor profile"
  ON public.doctors FOR INSERT
  WITH CHECK (auth.uid() = id);

-- ุณูุงุณุงุช ุงูุชุนุฏูู (UPDATE)
CREATE POLICY "Doctors can update their own profile"
  ON public.doctors FOR UPDATE
  USING (auth.uid() = id)
  WITH CHECK (auth.uid() = id);

CREATE POLICY "Admins can update any doctor"
  ON public.doctors FOR UPDATE
  USING (auth.uid() IN (SELECT id FROM public.admins));

-- ุณูุงุณุงุช ุงูุญุฐู (DELETE)
CREATE POLICY "Doctors can delete their own profile"
  ON public.doctors FOR DELETE
  USING (auth.uid() = id);

CREATE POLICY "Admins can delete any doctor"
  ON public.doctors FOR DELETE
  USING (auth.uid() IN (SELECT id FROM public.admins));
```

**ุฃู ุงุณุชุฎุฏู ุงูููู ุงูุฌุงูุฒ**: `fix_doctor_policies.sql`

---

### ุงูุฎุทูุฉ 2๏ธโฃ: ุชุนุทูู Email Confirmation (ููุชุทููุฑ)

1. ุงูุชุญ **Supabase Dashboard**
2. ุงุฐูุจ ุฅูู **Authentication** โ **Settings**
3. ุงุจุญุซ ุนู **Enable email confirmations**
4. ูู ุจู **ุชุนุทููู** (ุงุฌุนูู OFF)

โ๏ธ **ููุงุญุธุฉ**: ูู ุงูุฅูุชุงุฌุ ููุถู ุงุณุชุฎุฏุงู Edge Function ููุง ูู ููุถุญ ูู `ADMIN_FIX_GUIDE.md`

---

### ุงูุฎุทูุฉ 3๏ธโฃ: ููู ุขููุฉ ุงูุนูู ุงูุฌุฏูุฏุฉ

ุนูุฏ ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ ูู ููุญุฉ ุงููุฏูุฑ:

1. โ ูุชู ุฅูุดุงุก ุญุณุงุจ ุงูุทุจูุจ ูู Supabase
2. โ ูุชู ุฅุถุงูุฉ ุจูุงูุงุช ุงูุทุจูุจ ูู ุฌุฏูู `doctors`
3. โ๏ธ ูุชู ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ **ุชููุงุฆูุงู** (ูุฐุง ุทุจูุนู)
4. ๐ฑ ูุธูุฑ ูุฑุจุน ุญูุงุฑ ุจูููุฉ ุงููุฑูุฑ ูุฅุนุทุงุฆูุง ููุทุจูุจ
5. ๐ ุณูุนูุฏ ุงููุฏูุฑ ูุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู
6. โ ูุณุฌู ุงููุฏูุฑ ุฏุฎููู ูุฑุฉ ุฃุฎุฑู ููุฑู ุงูุทุจูุจ ุงูุฌุฏูุฏ

**ููุงุฐุง ูุชู ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑุ**
- ุนูุฏ ุงุณุชุฎุฏุงู `signUp`ุ ูููู Supabase ุจุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ ุชููุงุฆูุงู
- ูุฐูู ูุชู ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ
- ุงูุญู ุงูุฃูุซู ูู ุงุณุชุฎุฏุงู Supabase Admin API (ุงูุธุฑ `ADMIN_FIX_GUIDE.md`)

---

## ๐ฏ ุงูุขู ููููู:

### ูููุฏูุฑ:
โ ุฅุถุงูุฉ ุฃุทุจุงุก ุฌุฏุฏ ูู ููุญุฉ ุงูุชุญูู
โ ุชุนุฏูู ุจูุงูุงุช ุฃู ุทุจูุจ
โ ุญุฐู ุญุณุงุจุงุช ุงูุฃุทุจุงุก

### ููุทุจูุจ:
โ ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจูุงูุงุช ุงููุนุทุงุฉ ูู ุงููุฏูุฑ
โ ุชุนุฏูู ุจูุงูุงุชู ุงูุดุฎุตูุฉ ุจุงููุงูู
โ ุฑูุน ุงูุตูุฑ ูุงููุนูููุงุช ุงูุฅุถุงููุฉ
โ ุญุฐู ุญุณุงุจู ุฅุฐุง ุฃุฑุงุฏ

---

## ๐ ููุงุญุธุงุช ูููุฉ:

### ุนูุฏ ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ:
1. **ุงุญูุธ ูููุฉ ุงููุฑูุฑ** ุงููุนุฑูุถุฉ ูู ุงููุฑุจุน
2. **ุฃุฑุณููุง ููุทุจูุจ** ุนุจุฑ ูุณููุฉ ุขููุฉ
3. **ุฃุฎุจุฑ ุงูุทุจูุจ** ุจุชุณุฌูู ุงูุฏุฎูู ูุชุนุฏูู ูููุฉ ุงููุฑูุฑ
4. **ุณุฌู ุฏุฎููู ููุฏูุฑ ูุฑุฉ ุฃุฎุฑู** ุจุนุฏ ุฅุถุงูุฉ ุงูุทุจูุจ

### ุนูุฏ ุชุณุฌูู ุฏุฎูู ุงูุทุจูุจ ูุฃูู ูุฑุฉ:
1. ูุณุชุฎุฏู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ ุงููุนุทุงุฉ
2. ูุฐูุจ ูุดุงุดุฉ ุงูููู ุงูุดุฎุตู
3. ูุนุฏู ุฌููุน ุจูุงูุงุชู (ุงูุตูุฑุฉุ ุงููุนูููุงุชุ ุงูุนููุงูุ ุฅูุฎ)
4. **ููู**: ูุบูุฑ ูููุฉ ุงููุฑูุฑ ููููุฉ ุณุฑูุฉ ุฎุงุตุฉ ุจู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:

### ุฅุฐุง ูุดูุช ุฅุถุงูุฉ ุงูุทุจูุจ:
1. ุชุญูู ูู ุชูููุฐ SQL ุงูุณูุงุณุงุช ุฃุนูุงู
2. ุชุญูู ูู ุชุนุทูู Email Confirmation
3. ุชุญูู ูู Logs ูู Supabase:
   - **Dashboard** โ **Logs**
   - ุงูุธุฑ ุฅูู **Auth Logs** ู **Postgres Logs**

### ุฅุฐุง ูู ูุธูุฑ ุงูุทุจูุจ ูู ููุญุฉ ุงููุฏูุฑ:
- ูุฐุง ุทุจูุนู! ุงููุฏูุฑ ุชู ุชุณุฌูู ุฎุฑูุฌู
- ุณุฌู ุฏุฎูู ุงููุฏูุฑ ูุฑุฉ ุฃุฎุฑู ูุณุชุฌุฏ ุงูุทุจูุจ

### ุฅุฐุง ูู ูุณุชุทุน ุงูุทุจูุจ ุชุนุฏูู ุจูุงูุงุชู:
1. ุชุฃูุฏ ูู ุชูููุฐ ุณูุงุณุงุช UPDATE ูู SQL
2. ุชุฃูุฏ ูู ุฃู ุงูุทุจูุจ ูุณุฌู ุฏุฎูู ุจุดูู ุตุญูุญ
3. ุชุญูู ูู ุงูู session ูู ุงูุชุทุจูู

---

## ๐ ูููุณุชูุจู: ุงูุญู ุงูุฃูุซู

ููุฅูุชุงุฌุ ูููุตุญ ุจุงุณุชุฎุฏุงู **Supabase Edge Function** ูุน **Admin API**:

- ูู ูุชุทูุจ ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ
- ุฃูุซุฑ ุฃูุงูุงู ูููุซูููุฉ
- ูุณูุญ ุจุชุฃููุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุชููุงุฆูุงู
- ุฑุงุฌุน `ADMIN_FIX_GUIDE.md` ููุชูุงุตูู ุงููุงููุฉ

---

## โ ุฎูุงุตุฉ ุงูุชุญุฏูุซุงุช:

| ุงูููู | ุงูุชุนุฏูู |
|------|---------|
| `admin_service.dart` | โ ุชุญุฏูุซ ููุทู ุฅูุดุงุก ุงูุญุณุงุจ |
| `admin_add_doctor_screen.dart` | โ ูุนุงูุฌุฉ ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ |
| `admin_setup.sql` | โ ุฅุถุงูุฉ ุณูุงุณุงุช UPDATE ู DELETE |
| `fix_doctor_policies.sql` | โ ุณูุฑูุจุช ุฅุตูุงุญ ุณุฑูุน |

---

**๐ ุงูุขู ุงููุธุงู ูุนูู ุจุดูู ูุงูู!**
