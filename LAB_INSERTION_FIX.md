# โ ุชู ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุธููุฑ ุงููุนุงูู ูู Supabase

## ุงููุดููุฉ ุงูุฃุตููุฉ
ุนูุฏ ุฅุถุงูุฉ ูุนูู ูู ุตูุญุฉ ุงููุฏูุฑุ ูุงู ุงููุนูู ูุง ูุธูุฑ ูู ุฌุฏูู Supabase.

## ุงูุณุจุจ ุงูุฌุฐุฑู
ุงููุดููุฉ ูุงูุช ุฃู `signUp()` ูู Supabase ูุณุฌู ุฏุฎูู ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ ุชููุงุฆูุงูุ ููุง ูุทุฑุฏ ุฌูุณุฉ ุงููุฏูุฑ. ุซู ุนูุฏ ูุชุญ ุตูุญุฉ `AddLabScreen`ุ ูุง ููุฌุฏ ูุณุชุฎุฏู ูุณุฌู ุฏุฎููุ ูุฐูู ุชูุดู ุนูููุฉ ุญูุธ ุงูุจูุงูุงุช.

## ุงูุญู ุงููุทุจู

### 1. ุชุนุฏูู `lab_register_screen.dart`
ุจุฏูุงู ูู ุฅุฑุฌุงุน `true` ููุทุ ุฃุตุจุญุช ุงูุตูุญุฉ ุชุฑุฌุน ุจูุงูุงุช ุงูุชุณุฌูู (email + password):

```dart
Navigator.pop(context, {
  'success': true,
  'email': email,
  'password': password,
});
```

### 2. ุชุนุฏูู `admin_panel_screen.dart`
ุชู ุชุนุฏูู ุฏุงูุฉ `_handleAddLab()` ููููุงู ุจุงูุฎุทูุงุช ุงูุชุงููุฉ:

```dart
1. ุงููุฏูุฑ ููุชุญ ุตูุญุฉ ุชุณุฌูู ุงููุนูู (LabRegisterScreen)
2. ูุชู ุฅูุดุงุก ุญุณุงุจ ุงููุนูู ุงูุฌุฏูุฏ
3. ูุชู ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุชุณุฌูู (email + password)
4. ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ
5. ุชุณุฌูู ุฏุฎูู ุงููุนูู ุจุงูุจูุงูุงุช ุงููุณุชุฑุฌุนุฉ
6. ูุชุญ ุตูุญุฉ AddLabScreen ูุฅุฏุฎุงู ุจูุงูุงุช ุงููุนูู
7. ุญูุธ ุจูุงูุงุช ุงููุนูู ูู Supabase
8. ุชุณุฌูู ุฎุฑูุฌ ุงููุนูู
9. ุงููุฏูุฑ ูุญุชุงุฌ ูุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
```

### 3. ุฅุถุงูุฉ Logging ููุตู
ุชู ุฅุถุงูุฉ ุณุฌูุงุช ุชูุตูููุฉ (console logging) ูู:
- `lib/services/lab_service.dart` - registerLab() ู upsertLabData()
- `lib/screens/lab_register_screen.dart` - _register()
- `lib/screens/admin_panel_screen.dart` - _handleAddLab()
- `lib/screens/add_lab_screen.dart` - _saveLabData()

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุฎุทูุงุช ุฅุถุงูุฉ ูุนูู ุฌุฏูุฏ:

1. **ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ:**
   - ุงูุชุญ ุงูุชุทุจูู ูุณุฌู ุฏุฎูู ููุฏูุฑ

2. **ุฅุถุงูุฉ ูุนูู:**
   - ุงุถุบุท ุนูู "ุฅุถุงูุฉ ูุนูู" (ุงูุฒุฑ ุงูุจููุณุฌู ูู ุตูุญุฉ ุงููุฏูุฑ)
   - ุฃุฏุฎู ุจูุงูุงุช ุงูุชุณุฌูู:
     - ุงุณู ุงููุนูู
     - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
     - ูููุฉ ุงููุฑูุฑ
   - ุงุถุบุท "ุชุณุฌูู"

3. **ุฅุฏุฎุงู ุงูุจูุงูุงุช ุงููุงููุฉ:**
   - ุณูุชู ูุชุญ ุตูุญุฉ ุฅุถุงูุฉ ุจูุงูุงุช ุงููุนูู ุชููุงุฆูุงู
   - ุฃุฏุฎู ุฌููุน ุงููุนูููุงุช:
     - ุงูุงุณู (ูุทููุจ)
     - ุงูุนููุงู
     - ุฑูู ุงููุงุชู
     - ูุงุชุณุงุจ
     - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
     - ุณุงุนุงุช ุงูุนูู
     - ุงูุนุฑูุถ
     - ุงูุชุนุงูุฏุงุช
     - ุงููููุฒุงุช (ูุงุฆูุฉ)
     - ุงูุชุญุงููู (ุฑูุชูููุฉ ููุชุฎุตุตุฉ)
   - ุงุถุบุท "ุญูุธ"

4. **ุฅุนุงุฏุฉ ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ:**
   - ุจุนุฏ ุญูุธ ุงููุนููุ ุณูุชู ุชุณุฌูู ุฎุฑูุฌู ุชููุงุฆูุงู
   - ุณุฌู ุฏุฎูู ููุฏูุฑ ูุฑุฉ ุฃุฎุฑู

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุนูููุฉ

### 1. ูู Console:
ุฑุงูุจ ุงูุฑุณุงุฆู ุงูุชุงููุฉ ุจุงูุชุฑุชูุจ:
```
๐จโ๐ผ Admin: Opening lab registration...
๐ฅ Starting registration from LabRegisterScreen...
๐ Starting lab registration...
๐ Lab name: [ุงุณู], Email: [ุจุฑูุฏ]
๐ Auth response: [UUID]
๐ Inserting lab data: {user_id: ..., name: ..., email: ..., is_published: false}
โ Lab record created successfully!
๐ฅ Registration result: {success: true, ...}
๐ฅ Returning credentials to login...
๐จโ๐ผ Admin: Lab registration result: {success: true, email: ..., password: ...}
๐จโ๐ผ Admin: Logging out admin temporarily...
๐จโ๐ผ Admin: Logging in lab...
๐จโ๐ผ Admin: Opening AddLabScreen...
๐พ Saving lab data...
๐พ Name: [ุงุณู ุงููุนูู]
๐พ Features: [...]
๐พ Tests: {ุชุญุงููู ุฑูุชูููุฉ: [...], ุชุญุงููู ูุชุฎุตุตุฉ: [...]}
๐ Current user: [UUID]
๐ User email: [ุจุฑูุฏ]
๐ Existing lab: {id: ..., name: ..., ...}
๐ Updating existing lab...
โ Lab updated successfully!
๐พ Lab data saved successfully!
๐จโ๐ผ Admin: AddLabScreen result: true
๐จโ๐ผ Admin: Logging out lab...
```

### 2. ูู Supabase Dashboard:
1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู Table Editor โ labs
3. ูุฌุจ ุฃู ุชุฑู ุณุฌู ุฌุฏูุฏ ูุญุชูู ุนูู:
   - id (UUID)
   - user_id (UUID)
   - name (ุงุณู ุงููุนูู)
   - ุฌููุน ุงูุญููู ุงูุฃุฎุฑู
   - is_published = false

### 3. ูู ุงูุชุทุจูู:
- ุงููุนูู ูู ูุธูุฑ ูู ุตูุญุฉ ุงููุนุงูู ูููุณุชุฎุฏููู ูุฃู `is_published = false`
- ูุฌุนูู ูุฑุฆูุงูุ ูู ุจุชุญุฏูุซ `is_published` ุฅูู `true` ูู Supabase Dashboard

## ููุงุญุธุงุช ูููุฉ

### ๐ ุงูุฃูุงู
- ูุชู ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ ุจุนุฏ ุฅุถุงูุฉ ุงููุนูู (ููุฃูุงู)
- ูุฌุจ ุนูู ุงููุฏูุฑ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู

### ๐ RLS Policies
ุงูู policies ุงูุญุงููุฉ ูู `create_labs_table.sql`:
```sql
-- ุงููุนูู ููููู ุฅุฏุฑุงุฌ ุณุฌูู ุงูุฎุงุต ููุท
CREATE POLICY "Lab owners can insert their own labs"
  ON labs FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- ุงููุนูู ููููู ุชุญุฏูุซ ุณุฌูู ุงูุฎุงุต ููุท
CREATE POLICY "Lab owners can update their own labs"
  ON labs FOR UPDATE
  USING (auth.uid() = user_id);
```

ูุฐู ุงูู policies ุชุถูู ุฃู ูู ูุนูู ููููู ููุท ุชุนุฏูู ุจูุงูุงุชู ุงูุฎุงุตุฉ.

### ๐ ุงูุชุดุฎูุต
ุฅุฐุง ูุงุฌูุช ูุดููุฉ:
1. ุดุบู `flutter run` ูุฑุงูุจ console
2. ุงุชุจุน ุงูุฑุณุงุฆู ุฎุทูุฉ ุจุฎุทูุฉ
3. ุฅุฐุง ุธูุฑุช ุฑุณุงูุฉ ุฎุทุฃ โุ ุงูุฑุฃูุง ุจุนูุงูุฉ
4. ุฑุงุฌุน [LAB_REGISTRATION_DEBUG_GUIDE.md](LAB_REGISTRATION_DEBUG_GUIDE.md) ููุญููู

### ๐ ุงูุจุฏุงุฆู
ุฅุฐุง ููุช ูุง ุชุฑูุฏ ุฅุฎุฑุงุฌ ุงููุฏูุฑ ูู ุฌูุณุชูุ ููููู:
1. ุงุณุชุฎุฏุงู Admin API ูู Supabase (ูุชุทูุจ Service Role Key)
2. ุฅูุดุงุก endpoint ุฎุงุต ูู Backend ูุฅูุดุงุก ุงููุณุชุฎุฏููู

## ุงูุฎูุงุตุฉ

โ **ุชู ุงูุฅุตูุงุญ:**
- ุงููุนุงูู ุชุธูุฑ ุงูุขู ูู ุฌุฏูู Supabase
- ุชุฏูู ุงูุนูู ูุงุถุญ ูููุธู
- Logging ููุตู ูุชุชุจุน ุงููุดุงูู

โ๏ธ **ูุชุทูุจ ุงูุชุจุงู:**
- ุงููุฏูุฑ ูุญุชุงุฌ ูุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุฅุถุงูุฉ ูุนูู
- ุงููุนุงูู ุงูุฌุฏูุฏุฉ ุชููู ุบูุฑ ููุดูุฑุฉ (is_published = false) ุงูุชุฑุงุถูุงู

๐ฏ **ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุตู ุจูุง:**
1. ุฅุถุงูุฉ workflow ูููุฏูุฑ ููุดุฑ/ุฅุฎูุงุก ุงููุนุงูู
2. ุฅุถุงูุฉ ุตูุญุฉ ูุฅุฏุงุฑุฉ ุงููุนุงูู (ุนุฑุถุ ุชุนุฏููุ ุญุฐู)
3. ุฅุถุงูุฉ ูุธุงู ููุงููุงุช ูููุนุงูู ูุจู ุงููุดุฑ
